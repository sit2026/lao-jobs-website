{% extends 'base.html' %}
{% load static %}

{% block title %}{{ job.title }} - {{ job.company.company_name }} | {{ SITE_NAME }}{% endblock %}

{% block meta_description %}{{ job.description|truncatewords:30 }}{% endblock %}

{% block content %}
<div class="container py-6">
    <!-- Back Button -->
    <a href="{% url 'jobs:list' %}" class="btn btn-ghost btn-sm mb-4">
        ‚Üê ‡∫Å‡∫±‡∫ö‡∫Ñ‡∫∑‡∫ô
    </a>

    <!-- Job Header -->
    <div class="job-card mb-6">
        <div class="flex flex-col md:flex-row gap-4 items-start">
            <div class="job-card-logo" style="width: 80px; height: 80px; font-size: 2rem;">
                {% if job.company.logo %}
                <img src="{{ job.company.logo.url }}" alt="{{ job.company.company_name }}">
                {% else %}
                üè¢
                {% endif %}
            </div>

            <div class="flex-1">
                <h1 class="text-2xl font-bold mb-2">{{ job.title }}</h1>
                <p class="text-lg text-secondary mb-2">{{ job.company.company_name }}</p>

                <div class="flex flex-wrap gap-2 mb-4">
                    {% if job.province %}
                    <span class="tag tag-location">üìç {{ job.province.name }}</span>
                    {% endif %}
                    {% if job.category %}
                    <span class="tag tag-type">{{ job.category.name }}</span>
                    {% endif %}
                </div>

                <div class="flex items-center gap-4 text-sm text-tertiary">
                    <span>‚è±Ô∏è ‡ªÄ‡∫´‡∫º‡∫∑‡∫≠ {{ job.days_remaining }} ‡∫°‡∫∑‡ªâ</span>
                    <span>üëÅÔ∏è {{ job.view_count }} ‡∫Ñ‡∫±‡ªâ‡∫á</span>
                </div>
            </div>
        </div>
    </div>

    <div class="grid md:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="md:col-span-2 space-y-6">
            <!-- Quick Info -->
            <div class="grid grid-cols-3 gap-4">
                <div class="job-card text-center">
                    <div class="text-2xl mb-1">üí∞</div>
                    <div class="text-sm text-tertiary">‡ªÄ‡∫á‡∫¥‡∫ô‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô</div>
                    <div class="font-semibold">{{ job.get_salary_display }}</div>
                </div>
                <div class="job-card text-center">
                    <div class="text-2xl mb-1">üè∑Ô∏è</div>
                    <div class="text-sm text-tertiary">‡∫õ‡∫∞‡ªÄ‡∫û‡∫î</div>
                    <div class="font-semibold">{{ job.get_job_type_display }}</div>
                </div>
                <div class="job-card text-center">
                    <div class="text-2xl mb-1">üë•</div>
                    <div class="text-sm text-tertiary">‡∫ï‡∫≥‡ªÅ‡ªú‡ªà‡∫á</div>
                    <div class="font-semibold">{{ job.positions_count }} ‡∫Ñ‡∫ª‡∫ô</div>
                </div>
            </div>

            <!-- Description -->
            <div class="job-card">
                <h2 class="text-lg font-semibold mb-4">üìã ‡∫•‡∫≤‡∫ç‡∫•‡∫∞‡∫≠‡∫Ω‡∫î‡∫ß‡∫Ω‡∫Å</h2>
                <div class="prose">
                    {{ job.description|linebreaks }}
                </div>
            </div>

            {% if job.requirements %}
            <div class="job-card">
                <h2 class="text-lg font-semibold mb-4">‚úÖ ‡∫Ñ‡∫∏‡∫ô‡∫™‡∫ª‡∫°‡∫ö‡∫±‡∫î‡∫ó‡∫µ‡ªà‡∫ï‡ªâ‡∫≠‡∫á‡∫Å‡∫≤‡∫ô</h2>
                <div class="prose">
                    {{ job.requirements|linebreaks }}
                </div>
            </div>
            {% endif %}

            {% if job.benefits %}
            <div class="job-card">
                <h2 class="text-lg font-semibold mb-4">üéÅ ‡∫™‡∫∞‡∫´‡∫ß‡∫±‡∫î‡∫î‡∫µ‡∫Å‡∫≤‡∫ô</h2>
                <div class="prose">
                    {{ job.benefits|linebreaks }}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="space-y-4">
            <!-- Contact Card -->
            <div class="job-card">
                <h3 class="font-semibold mb-4">‡∫ï‡∫¥‡∫î‡∫ï‡ªç‡ªà‡∫ö‡ªç‡∫•‡∫¥‡∫™‡∫±‡∫î</h3>

                {% if job.contact_phone %}
                <a href="tel:{{ job.contact_phone }}" class="btn btn-phone btn-lg mb-3">
                    üìû {{ job.contact_phone }}
                </a>
                {% endif %}

                <div class="grid grid-cols-2 gap-2">
                    {% if job.contact_whatsapp %}
                    <a href="https://wa.me/{{ job.contact_whatsapp }}" target="_blank" class="btn btn-whatsapp btn-sm">
                        WhatsApp
                    </a>
                    {% endif %}

                    {% if job.contact_messenger %}
                    <a href="{{ job.contact_messenger }}" target="_blank" class="btn btn-secondary btn-sm">
                        Messenger
                    </a>
                    {% endif %}

                    {% if job.contact_email %}
                    <a href="mailto:{{ job.contact_email }}" class="btn btn-secondary btn-sm col-span-2">
                        ‚úâÔ∏è {{ job.contact_email }}
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- Company Card -->
            <div class="job-card">
                <h3 class="font-semibold mb-4">‡∫Å‡ªà‡∫Ω‡∫ß‡∫Å‡∫±‡∫ö‡∫ö‡ªç‡∫•‡∫¥‡∫™‡∫±‡∫î</h3>

                <div class="flex items-center gap-3 mb-4">
                    <div class="job-card-logo" style="width: 50px; height: 50px;">
                        {% if job.company.logo %}
                        <img src="{{ job.company.logo.url }}" alt="{{ job.company.company_name }}">
                        {% else %}
                        üè¢
                        {% endif %}
                    </div>
                    <div>
                        <div class="font-semibold">{{ job.company.company_name }}</div>
                        {% if job.company.province %}
                        <div class="text-sm text-tertiary">{{ job.company.province.name }}</div>
                        {% endif %}
                    </div>
                </div>

                {% if job.company.description %}
                <p class="text-sm text-secondary mb-4">
                    {{ job.company.description|truncatewords:30 }}
                </p>
                {% endif %}

                <a href="{% url 'jobs:company_jobs' job.company.id %}" class="btn btn-secondary btn-sm w-full">
                    ‡ªÄ‡∫ö‡∫¥‡ªà‡∫á‡∫ß‡∫Ω‡∫Å‡∫ó‡∫±‡∫á‡ªù‡∫ª‡∫î
                </a>
            </div>

            <!-- Actions -->
            <div class="flex gap-2">
                <button class="btn btn-ghost flex-1" onclick="shareJob()">
                    üì§ ‡ªÅ‡∫ä‡∫£‡ªå
                </button>
                <button class="btn btn-ghost flex-1" onclick="reportJob()">
                    ‚ö†Ô∏è ‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô
                </button>
            </div>
        </div>
    </div>

    <!-- Similar Jobs -->
    {% if similar_jobs %}
    <section class="mt-8">
        <h2 class="section-title mb-4">‡∫ß‡∫Ω‡∫Å‡∫ó‡∫µ‡ªà‡∫Ñ‡ªâ‡∫≤‡∫ç‡∫Ñ‡∫∑‡∫Å‡∫±‡∫ô</h2>

        <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
            {% for sjob in similar_jobs %}
            <a href="{% url 'jobs:detail' sjob.id %}" class="job-card">
                <h3 class="job-card-title">{{ sjob.title }}</h3>
                <p class="job-card-company">{{ sjob.company.company_name }}</p>
                <div class="mt-2">
                    <span class="tag tag-salary text-xs">{{ sjob.get_salary_display }}</span>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>

<script>
function shareJob() {
    if (navigator.share) {
        navigator.share({
            title: '{{ job.title }}',
            text: '{{ job.title }} - {{ job.company.company_name }}',
            url: window.location.href
        });
    } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(window.location.href);
        alert('‡∫™‡∫≥‡ªÄ‡∫ô‡∫ª‡∫≤‡∫•‡∫¥‡ªâ‡∫á‡ªÅ‡∫•‡ªâ‡∫ß');
    }
}

function reportJob() {
    // Open report modal
    alert('‡∫ü‡∫±‡∫á‡∫ä‡∫±‡ªà‡∫ô‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô‡∫ç‡∫±‡∫á‡∫ö‡ªç‡ªà‡∫û‡ªâ‡∫≠‡∫°');
}
</script>
{% endblock %}
